<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <title>Athletic Specimen</title>

  <style>
    /* Table + badges used by Tournament views */
    .table { width:100%; border-collapse:collapse; }
    .table thead th { text-align:left; font-weight:600; border-bottom:1px solid #333; padding:6px 8px; }
    .table tbody td { border-bottom:1px solid #222; padding:6px 8px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#333; color:#ddd; font-size:12px; }

    /* Floating "Tournament" button (FAB) */
    #tab-tournament{
      position:fixed; right:16px; bottom:16px; z-index:10010;
      padding:10px 14px; border:0; border-radius:999px;
      background:#3b82f6; color:#fff; font-weight:600; cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.18);
    }

    /* Fullscreen overlay sheet for Tournament center */
    #view-tournament{
      display:none; position:fixed; inset:0; overflow:auto;
      background:rgba(0,0,0,.65); z-index:10000;
    }
    .tournament-sheet{
      max-width:1100px; margin:40px auto; background:#111; color:#eee;
      border-radius:12px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,0.4);
    }
    .tournament-header{
      display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px;
    }
    .tournament-header h2{ margin:0; font-size:20px; }
    .tournament-actions{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .full-width{ width:100%; }
  </style>
</head>
<body>
  <div id="root">
    <div style="padding:2rem;text-align:center;font-family:sans-serif;color:#fff;">
      Loading app, please wait...
    </div>
  </div>

  <!-- One single Tournament quick-open button -->
  <button id="tab-tournament">Tournament</button>

  <!-- Tournament overlay -->
  <div id="view-tournament" aria-hidden="true">
    <div class="tournament-sheet">
      <div class="tournament-header">
        <h2>Tournament Center</h2>
        <button id="closeTournamentBtn">Close</button>
      </div>

      <!-- Select tournament -->
      <div class="card" style="margin-bottom:12px;">
        <div class="tournament-actions">
          <label for="tournamentSelect">Tournament</label>
          <select id="tournamentSelect" style="min-width:220px;"></select>
        </div>
      </div>

      <!-- Public next matches -->
      <div class="card" style="margin-bottom:12px;">
        <h3 style="margin-top:0;">Public Schedule and Next Match</h3>
        <div id="publicNextMatches"></div>
      </div>

      <!-- Pool standings -->
      <div class="card" style="margin-bottom:12px;">
        <h3 style="margin-top:0;">Pool Standings</h3>
        <div id="poolStandings"></div>
      </div>

      <!-- Report score -->
      <div class="card" style="margin-bottom:12px;">
        <h3 style="margin-top:0;">Report Score</h3>
        <div class="tournament-actions" style="margin-bottom:8px;">
          <label for="reportMatchSelect">Match</label>
          <select id="reportMatchSelect" style="min-width:280px;"></select>

          <label for="teamA_score">Team A</label>
          <input id="teamA_score" type="number" min="0" step="1" style="width:90px;" />

          <label for="teamB_score">Team B</label>
          <input id="teamB_score" type="number" min="0" step="1" style="width:90px;" />

          <label for="reporterTeam">Your team name</label>
          <input id="reporterTeam" type="text" placeholder="Type your team name" style="min-width:180px;" />

          <button id="submitScoreBtn">Submit score</button>
        </div>
        <p id="reportStatus" class="small" style="margin:0;"></p>
      </div>

      <!-- Admin area (auto-hidden if not admin) -->
      <div id="adminTournament" class="card" style="margin-bottom:12px;">
        <h3 style="margin-top:0;">Admin Setup</h3>

        <div class="tournament-actions" style="margin-bottom:8px;">
          <input id="newTournamentName" type="text" placeholder="Tournament name" />
          <input id="newTournamentNets" type="number" min="1" value="3" style="width:100px;" />
          <button id="createTournamentBtn">Create</button>
        </div>

        <h4 style="margin:8px 0;">Add teams (one per line)</h4>
        <textarea id="bulkTeams" rows="6" class="full-width"></textarea>
        <div style="margin:8px 0;">
          <button id="addTeamsBtn">Add teams</button>
        </div>

        <h4 style="margin:8px 0;">Pools JSON</h4>
        <p class="small" style="margin:0 0 6px 0;">
          Example:
          <code>[{"name":"Pool A","teams":["Team 1","Team 2","Team 3","Team 4"]},{"name":"Pool B","teams":["Team 5","Team 6","Team 7","Team 8"]}]</code>
        </p>
        <textarea id="poolsJson" rows="6" class="full-width">[]</textarea>
        <div class="tournament-actions" style="margin:8px 0;">
          <button id="savePoolsBtn">Save pools</button>
          <button id="generatePoolScheduleBtn">Generate pool schedule</button>
        </div>

        <h4 style="margin:8px 0;">Admin Rankings</h4>
        <div id="adminRankings"></div>
      </div>
    </div>
  </div>

  <noscript>
    <div style="padding:2rem;text-align:center;font-family:sans-serif;color:#fff;">
      This app requires JavaScript to run.
    </div>
  </noscript>

  <!-- Small helpers -->
  <script>
    // Prevent tiny tap targets on iOS zooming
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input, textarea, select, button').forEach(el => {
        el.style.fontSize = '16px';
      });
    });
    // Fail-safe loader â€” show message if a JS file fails to load
    window.addEventListener('error', function (e) {
      if (e.target.tagName === 'SCRIPT') {
        const root = document.getElementById('root');
        if (root) {
          root.innerHTML = '<div style="padding:2rem;text-align:center;font-family:sans-serif;color:#fff;">Failed to load app files. Try refreshing the page.</div>';
        }
      }
    }, true);
  </script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
  <!-- Main App (contains showTournamentView + initTournamentView) -->
  <script src="app.js" defer></script>
</body>
</html>
